<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (version 1.7.0_45) on Thu May 28 20:09:44 CDT 2015 -->
<title>Database (Java Class Library API)</title>
<meta name="date" content="2015-05-28">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
</head>
<body>
<script type="text/javascript"><!--
    if (location.href.indexOf('is-external=true') == -1) {
        parent.document.title="Database (Java Class Library API)";
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar_top">
<!--   -->
</a><a href="#skip-navbar_top" title="Skip navigation links"></a><a name="navbar_top_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Database.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/jsimpledb/core/CreateListener.html" title="interface in org.jsimpledb.core"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/jsimpledb/core/DatabaseException.html" title="class in org.jsimpledb.core"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/jsimpledb/core/Database.html" target="_top">Frames</a></li>
<li><a href="Database.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<!-- ======== START OF CLASS DATA ======== -->
<div class="header">
<div class="subTitle">org.jsimpledb.core</div>
<h2 title="Class Database" class="title">Class Database</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</a></li>
<li>
<ul class="inheritance">
<li>org.jsimpledb.core.Database</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<hr>
<br>
<pre>public class <a href="../../../src-html/org/jsimpledb/core/Database.html#line.77">Database</a>
extends <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></pre>
<div class="block">Provides an object database abstraction on top of a key/value database.

 <p>
 Includes support for:
 <ul>
  <li>Objects and fields defined by a <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a>, with positive schema verification</li>
  <li>Simple values fields containing any atomic type, reference or custom <a href="../../../org/jsimpledb/core/FieldType.html" title="class in org.jsimpledb.core"><code>FieldType</code></a></li>
  <li>Complex fields of type <a href="https://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true" title="class or interface in java.util"><code>List</code></a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/util/NavigableSet.html?is-external=true" title="class or interface in java.util"><code>NavigableSet</code></a>, and <a href="https://docs.oracle.com/javase/7/docs/api/java/util/NavigableMap.html?is-external=true" title="class or interface in java.util"><code>NavigableMap</code></a></li>
  <li>Invertable reference fields with strong referential integrity and configurable delete cascading</li>
  <li>Configurable indexing of any simple field or complex sub-field</li>
  <li>Composite indexes on multiple simple fields</li>
  <li>Notification of object creation and deletion</li>
  <li>Notification of object field changes, as seen through an arbitrary path of references</li>
  <li>Automatic schema tracking and object versioning with schema change notification support</li>
 </ul>

 <p>
 See <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a> for further details on the above functionality.
 </p>

 <p>
 This class defines an abstraction layer that usually sits below a <a href="../../../org/jsimpledb/JSimpleDB.html" title="class in org.jsimpledb"><code>JSimpleDB</code></a> but is completely
 independent of <a href="../../../org/jsimpledb/JSimpleDB.html" title="class in org.jsimpledb"><code>JSimpleDB</code></a> and can be used on its own.
 Compared to <a href="../../../org/jsimpledb/JSimpleDB.html" title="class in org.jsimpledb"><code>JSimpleDB</code></a>, a <a href="../../../org/jsimpledb/core/Database.html" title="class in org.jsimpledb.core"><code>Database</code></a> has these differences:
 <ul>
  <li>A <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a> must be explicitly provided to define the schema in use, whereas when using a
      <a href="../../../org/jsimpledb/JSimpleDB.html" title="class in org.jsimpledb"><code>JSimpleDB</code></a> the schema is derived automatically from annotated Java model classes.</li>
  <li>Object references are represented by <a href="../../../org/jsimpledb/core/ObjId.html" title="class in org.jsimpledb.core"><code>ObjId</code></a>s instead of Java objects, and there is no notion of object sub-type.
      However, reference fields may be configured with a restricted set of referrable types.</li>
  <li>All object types and fields are referenced by explicit storage ID.</li>
  <li>Enum values are represented by <a href="../../../org/jsimpledb/core/EnumValue.html" title="class in org.jsimpledb.core"><code>EnumValue</code></a> objects.</li>
  <li>There is no automatic validation support.</li>
 </ul></div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a>, 
<a href="../../../org/jsimpledb/package-summary.html"><code>org.jsimpledb</code></a></dd></dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- =========== FIELD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_summary">
<!--   -->
</a>
<h3>Field Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Field Summary table, listing fields, and an explanation">
<caption><span>Fields</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Field and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static int</code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/core/Database.html#MAX_INDEXED_FIELDS">MAX_INDEXED_FIELDS</a></strong></code>
<div class="block">The maximum number of fields that may be indexed in a composite index (4).</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Constructor Summary table, listing constructors, and an explanation">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colOne" scope="col">Constructor and Description</th>
</tr>
<tr class="altColor">
<td class="colOne"><code><strong><a href="../../../org/jsimpledb/core/Database.html#Database(org.jsimpledb.kv.KVDatabase)">Database</a></strong>(<a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv">KVDatabase</a>&nbsp;kvdb)</code>
<div class="block">Constructor.</div>
</td>
</tr>
</table>
</li>
</ul>
<!-- ========== METHOD SUMMARY =========== -->
<ul class="blockList">
<li class="blockList"><a name="method_summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="overviewSummary" border="0" cellpadding="3" cellspacing="0" summary="Method Summary table, listing methods, and an explanation">
<caption><span>Methods</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colLast" scope="col">Method and Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core">Transaction</a></code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/core/Database.html#createTransaction(org.jsimpledb.schema.SchemaModel, int, boolean)">createTransaction</a></strong>(<a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema">SchemaModel</a>&nbsp;schemaModel,
                                  int&nbsp;version,
                                  boolean&nbsp;allowNewSchema)</code>
<div class="block">Create a new <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a> on this database and use the specified schema version to access objects and fields.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code><a href="../../../org/jsimpledb/core/FieldTypeRegistry.html" title="class in org.jsimpledb.core">FieldTypeRegistry</a></code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/core/Database.html#getFieldTypeRegistry()">getFieldTypeRegistry</a></strong>()</code>
<div class="block">Get the <a href="../../../org/jsimpledb/core/FieldTypeRegistry.html" title="class in org.jsimpledb.core"><code>FieldTypeRegistry</code></a> associated with this instance.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><code><a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv">KVDatabase</a></code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/core/Database.html#getKVDatabase()">getKVDatabase</a></strong>()</code>
<div class="block">Get the <a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv"><code>KVDatabase</code></a> underlying this instance.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>void</code></td>
<td class="colLast"><code><strong><a href="../../../org/jsimpledb/core/Database.html#validateSchema(org.jsimpledb.schema.SchemaModel)">validateSchema</a></strong>(<a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema">SchemaModel</a>&nbsp;schemaModel)</code>
<div class="block">Validate a <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a>.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a name="methods_inherited_from_class_java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.<a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</a></h3>
<code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#toString()" title="class or interface in java.lang">toString</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</a>, <a href="https://docs.oracle.com/javase/7/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</a></code></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ FIELD DETAIL =========== -->
<ul class="blockList">
<li class="blockList"><a name="field_detail">
<!--   -->
</a>
<h3>Field Detail</h3>
<a name="MAX_INDEXED_FIELDS">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>MAX_INDEXED_FIELDS</h4>
<pre>public static final&nbsp;int <a href="../../../src-html/org/jsimpledb/core/Database.html#line.83">MAX_INDEXED_FIELDS</a></pre>
<div class="block">The maximum number of fields that may be indexed in a composite index (4).</div>
<dl><dt><span class="strong">See Also:</span></dt><dd><a href="../../../constant-values.html#org.jsimpledb.core.Database.MAX_INDEXED_FIELDS">Constant Field Values</a></dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<ul class="blockList">
<li class="blockList"><a name="constructor_detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a name="Database(org.jsimpledb.kv.KVDatabase)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>Database</h4>
<pre>public&nbsp;<a href="../../../src-html/org/jsimpledb/core/Database.html#line.160">Database</a>(<a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv">KVDatabase</a>&nbsp;kvdb)</pre>
<div class="block">Constructor.</div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>kvdb</code> - the underlying key/value store in which to store information</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>kvdb</code> is null</dd></dl>
</li>
</ul>
</li>
</ul>
<!-- ============ METHOD DETAIL ========== -->
<ul class="blockList">
<li class="blockList"><a name="method_detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a name="getFieldTypeRegistry()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getFieldTypeRegistry</h4>
<pre>public&nbsp;<a href="../../../org/jsimpledb/core/FieldTypeRegistry.html" title="class in org.jsimpledb.core">FieldTypeRegistry</a>&nbsp;<a href="../../../src-html/org/jsimpledb/core/Database.html#line.171">getFieldTypeRegistry</a>()</pre>
<div class="block">Get the <a href="../../../org/jsimpledb/core/FieldTypeRegistry.html" title="class in org.jsimpledb.core"><code>FieldTypeRegistry</code></a> associated with this instance.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>field type registry associated with this instance</dd></dl>
</li>
</ul>
<a name="getKVDatabase()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getKVDatabase</h4>
<pre>public&nbsp;<a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv">KVDatabase</a>&nbsp;<a href="../../../src-html/org/jsimpledb/core/Database.html#line.180">getKVDatabase</a>()</pre>
<div class="block">Get the <a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv"><code>KVDatabase</code></a> underlying this instance.</div>
<dl><dt><span class="strong">Returns:</span></dt><dd>underlying key/value database</dd></dl>
</li>
</ul>
<a name="createTransaction(org.jsimpledb.schema.SchemaModel, int, boolean)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>createTransaction</h4>
<pre>public&nbsp;<a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core">Transaction</a>&nbsp;<a href="../../../src-html/org/jsimpledb/core/Database.html#line.296">createTransaction</a>(<a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema">SchemaModel</a>&nbsp;schemaModel,
                            int&nbsp;version,
                            boolean&nbsp;allowNewSchema)</pre>
<div class="block">Create a new <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a> on this database and use the specified schema version to access objects and fields.

 <p>
 <b>Schema Versions</b>
 </p>

 <p>
 Within each <a href="../../../org/jsimpledb/core/Database.html" title="class in org.jsimpledb.core"><code>Database</code></a> is stored a record of all schema versions previously used with the database.
 When creating a new transaction, the caller provides an expected schema version and corresponding <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a>.
 Both of these are optional: a schema version of zero means "use the highest version recorded in the
 database", and a null <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a> means "use the <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a> already recorded in the database under
 <code>version</code>".
 </p>

 <p>
 When this method is invoked, the following checks are applied:
 <ul>
  <li>If a schema with version number <code>version != 0</code> is recorded in the database, and <code>schemaModel</code> is null or
      matches it, then this method succeeds, and the <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a> will use that schema.</li>
  <li>If a schema with version number <code>version</code> (or the highest numbered schema if <code>version == 0</code>)
      is recorded in the database, and <code>schemaModel</code> is not null and does not match it, then this method fails
      and throws a <a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core"><code>SchemaMismatchException</code></a>.</li>
  <li>If <code>allowNewSchema</code> is false, and no schema with version number <code>version != 0</code> has yet been
      recorded in the database, then this method fails and throws a <a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core"><code>SchemaMismatchException</code></a>.</li>
  <li>If <code>allowNewSchema</code> is true, and no schema with version number <code>version != 0</code> has yet been
      recorded in the database, then if <code>schemaModel</code> is null a <a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core"><code>SchemaMismatchException</code></a> is thrown;
      otherwise <code>schemaModel</code> is checked for compabitility with the schemas previously recorded in the database;
      if compatible, this method succeeds, <code>schema</code> is recorded in the database under the new version number
      <code>version</code>, and the <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a> will use schema version <code>version</code>;
      otherwise a <a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core"><code>SchemaMismatchException</code></a> is thrown.</li>
  <li>If the database is uninitialized and <code>version == 0</code> or <code>schemaModel</code> is null,
      a <a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core"><code>SchemaMismatchException</code></a> is thrown.</li>
 </ul>

 <p>
 For two schemas to "match", they must be identical in all respects, except that object, field, and index names may differ.
 In the core API, objects and fields are identified by storage ID, not name.
 </p>

 <p>
 Schemas must also be compatible with all other schemas previously recorded in the database.
 Basically this means storage IDs must be used consistently from a structural point of view:
 <ul>
  <li>Once a storage ID is assigned, it cannot be re-assigned to a different type of item (object or field).</li>
  <li>Fields must have a consistent type and structural parent (object type or complex field).</li>
 </ul>

 <p>
 However, object types and fields may be added or removed across schema versions, field indexing may change,
 and reference field <a href="../../../org/jsimpledb/core/DeleteAction.html" title="enum in org.jsimpledb.core"><code>DeleteAction</code></a>s may change.
 </p>

 <p>
 <b>Object Versions</b>
 </p>

 <p>
 Each object in a <a href="../../../org/jsimpledb/core/Database.html" title="class in org.jsimpledb.core"><code>Database</code></a> contains an internal version number that indicates its current schema version;
 this in turn dictates what fields that object contains.
 </p>

 <p>
 When an object is accessed during a <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a>, the object's version is compared to the <code>version</code> associated
 with that <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a>. If the versions are the same, no version change occurs and fields are accessed normally.
 </p>

 <p>
 If the object has a version <code>oldVersion</code> different from <code>version</code>, then depending on which <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a>
 method is invoked, the object version may be automatically updated to <code>version</code>. This will cause fields to be added
 or removed, as follows:
 <ul>
  <li>Fields that are common to both schema versions remain unchanged (necessarily such fields have the same storage ID,
      type, and structural parent).</li>
  <li>Fields that exist in <code>oldVersion</code> but not in <code>version</code> are removed.</li>
  <li>Fields that exist in <code>version</code> but not in <code>oldVersion</code> are initialized to their default values.</li>
  <li>All <a href="../../../org/jsimpledb/core/VersionChangeListener.html" title="interface in org.jsimpledb.core"><code>VersionChangeListener</code></a>s registered with the <a href="../../../org/jsimpledb/core/Transaction.html" title="class in org.jsimpledb.core"><code>Transaction</code></a> are notified.</li>
 </ul>

 <p>
 Note that compatibility between schema versions does not depend on the field name, nor does it depend on whether the field
 is indexed, or its <a href="../../../org/jsimpledb/core/DeleteAction.html" title="enum in org.jsimpledb.core"><code>DeleteAction</code></a> (for reference fields). A field's index may be added or removed between schema
 versions without losing information, however, querying a field's index will only return those objects whose schema
 version corresponds to a schema in which the field is indexed. Similarly, the <a href="../../../org/jsimpledb/core/DeleteAction.html" title="enum in org.jsimpledb.core"><code>DeleteAction</code></a> taken when a
 referenced object is deleted depends on the <a href="../../../org/jsimpledb/core/DeleteAction.html" title="enum in org.jsimpledb.core"><code>DeleteAction</code></a> configured in the schema version of the object
 containing the reference.
 </p>

 <p>
 Note that an object's current schema version can go up as well as down, may change non-consecutively, and in fact
 nothing requires schema version numbers to be consecutive.
 </p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>schemaModel</code> - schema to use with the new transaction, or null to use the schema already recorded in the database</dd><dd><code>version</code> - the schema version number corresponding to <code>schemaModel</code>, or zero to use the highest recorded version</dd><dd><code>allowNewSchema</code> - whether creating a new schema version is allowed</dd>
<dt><span class="strong">Returns:</span></dt><dd>newly created transaction</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>version</code> is less than zero</dd>
<dd><code><a href="../../../org/jsimpledb/core/InvalidSchemaException.html" title="class in org.jsimpledb.core">InvalidSchemaException</a></code> - if <code>schemaModel</code> is invalid (i.e., does not pass validation checks)</dd>
<dd><code><a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core">SchemaMismatchException</a></code> - if <code>schemaModel</code> does not match schema version <code>version</code>
  as recorded in the database</dd>
<dd><code><a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core">SchemaMismatchException</a></code> - if schema version <code>version</code> is not recorded in the database
  and <code>allowNewSchema</code> is false</dd>
<dd><code><a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core">SchemaMismatchException</a></code> - if schema version <code>version</code> is not recorded in the database,
  <code>allowNewSchema</code> is true, but <code>schemaModel</code> is incompatible with one or more other schemas
  already recorded in the database (i.e., the same storage ID is used inconsistently between schema versions)</dd>
<dd><code><a href="../../../org/jsimpledb/core/SchemaMismatchException.html" title="class in org.jsimpledb.core">SchemaMismatchException</a></code> - if the database is uninitialized and <code>version == 0</code> or <code>schemaModel</code> is null</dd>
<dd><code><a href="../../../org/jsimpledb/core/InconsistentDatabaseException.html" title="class in org.jsimpledb.core">InconsistentDatabaseException</a></code> - if inconsistent or invalid schema information is detected in the database</dd>
<dd><code><a href="../../../org/jsimpledb/core/InconsistentDatabaseException.html" title="class in org.jsimpledb.core">InconsistentDatabaseException</a></code> - if an uninitialized database is encountered but the database is not empty</dd>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/IllegalStateException.html?is-external=true" title="class or interface in java.lang">IllegalStateException</a></code> - if no underlying <a href="../../../org/jsimpledb/kv/KVDatabase.html" title="interface in org.jsimpledb.kv"><code>KVDatabase</code></a> has been configured for this instance</dd></dl>
</li>
</ul>
<a name="validateSchema(org.jsimpledb.schema.SchemaModel)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>validateSchema</h4>
<pre>public&nbsp;void&nbsp;<a href="../../../src-html/org/jsimpledb/core/Database.html#line.520">validateSchema</a>(<a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema">SchemaModel</a>&nbsp;schemaModel)</pre>
<div class="block">Validate a <a href="../../../org/jsimpledb/schema/SchemaModel.html" title="class in org.jsimpledb.schema"><code>SchemaModel</code></a>.

 <p>
 This method only performs "static" checks; it does not access the database and therefore
 does not validate the schema against existing schema versions previously recorded.
 It does however use the <a href="../../../org/jsimpledb/core/FieldTypeRegistry.html" title="class in org.jsimpledb.core"><code>FieldTypeRegistry</code></a> associated with this instance to look up field types.
 </p>

 <p>
 To validate a schema against the database contents as well, simply attempt to create a transaction
 via <a href="../../../org/jsimpledb/core/Database.html#createTransaction(org.jsimpledb.schema.SchemaModel, int, boolean)"><code>createTransaction()</code></a>.
 </p></div>
<dl><dt><span class="strong">Parameters:</span></dt><dd><code>schemaModel</code> - schema to validate</dd>
<dt><span class="strong">Throws:</span></dt>
<dd><code><a href="../../../org/jsimpledb/core/InvalidSchemaException.html" title="class in org.jsimpledb.core">InvalidSchemaException</a></code> - if <code>schemaModel</code> is invalid</dd>
<dd><code><a href="https://docs.oracle.com/javase/7/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang">IllegalArgumentException</a></code> - if <code>schemaModel</code> is null</dd></dl>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<!-- ========= END OF CLASS DATA ========= -->
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar_bottom">
<!--   -->
</a><a href="#skip-navbar_bottom" title="Skip navigation links"></a><a name="navbar_bottom_firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../overview-summary.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/Database.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li><a href="../../../org/jsimpledb/core/CreateListener.html" title="interface in org.jsimpledb.core"><span class="strong">Prev Class</span></a></li>
<li><a href="../../../org/jsimpledb/core/DatabaseException.html" title="class in org.jsimpledb.core"><span class="strong">Next Class</span></a></li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?org/jsimpledb/core/Database.html" target="_top">Frames</a></li>
<li><a href="Database.html" target="_top">No Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li><a href="#field_summary">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li><a href="#field_detail">Field</a>&nbsp;|&nbsp;</li>
<li><a href="#constructor_detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method_detail">Method</a></li>
</ul>
</div>
<a name="skip-navbar_bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
